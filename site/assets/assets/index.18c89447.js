var mt=Object.defineProperty;var pt=(t,e,i)=>e in t?mt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var r=(t,e,i)=>(pt(t,typeof e!="symbol"?e+"":e,i),i);import{c as k,s as rt,n as nt,p as _t,o as ft,a as et,b as O,u as xt,m as ot,d as ht,i as ct,e as Et,f as W,l as Mt,g as j,h as vt,j as wt,r as Dt,k as yt,q as gt,v as At,A as Tt}from"./vendor.adb55ed6.js";var bt=Object.defineProperty,St=(t,e,i)=>e in t?bt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,N=(t,e,i)=>(St(t,typeof e!="symbol"?e+"":e,i),i),dt=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},A=(t,e,i)=>(dt(t,e,"read from private field"),i?i.call(t):e.get(t)),Z=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},Ht=(t,e,i,a)=>(dt(t,e,"write to private field"),a?a.call(t,i):e.set(t,i),i),q="-- DEFINES_HOOK --",Ut=(t,e,i,a={})=>{if(Object.keys(a).length&&!i.includes(q))throw new Error(`in order to include defines, you must provide "${q}" in your shader code`);let s="";for(const[c,u]of Object.entries(a)){if(typeof u=="boolean"&&!u)continue;let l=`${u}`;typeof u=="number"&&Number.isInteger(u)&&(l+=".0"),s+=`#define ${c} ${l}
`}i=i.replace(q,s);const n=t.createShader(e);if(t.shaderSource(n,i),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS))return n;const o=`
    Error in ${e===t.VERTEX_SHADER?"Vertex":"Fragment"} shader:
    ${t.getShaderInfoLog(n)}
  `;throw t.deleteShader(n),new Error(o)},it=Ut,Rt=(t,e,i,a)=>{const s=it(t,t.VERTEX_SHADER,e,a),n=it(t,t.FRAGMENT_SHADER,i,a),o=t.createProgram();if(t.attachShader(o,s),t.attachShader(o,n),t.linkProgram(o),t.detachShader(o,s),t.deleteShader(s),t.detachShader(o,n),t.deleteShader(n),t.getProgramParameter(o,t.LINK_STATUS))return o;const c=new Error(`Error linking program: ${t.getProgramInfoLog(o)}`);throw t.deleteProgram(o),c},It=Rt,Ft=(t,e,i,a)=>{const s=t.getUniformBlockIndex(e,i),n=t.getActiveUniformBlockParameter(e,s,t.UNIFORM_BLOCK_DATA_SIZE),o=t.getActiveUniformBlockParameter(e,s,t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER),c=t.getActiveUniformBlockParameter(e,s,t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER),u=t.getUniformIndices(e,a),l=t.getActiveUniforms(e,u,t.UNIFORM_OFFSET),m=t.getActiveUniforms(e,u,t.UNIFORM_SIZE),d={};for(let f=0;f<a.length;f++){const h=a[f],_={index:u[f],offset:l[f],size:m[f]};d[h]=_}return{blockIndex:s,blockSize:n,usedInVertexShader:o,usedInFragmentShader:c,uniforms:d}},$t=Ft,kt=(t,e,i=0,a=t.DYNAMIC_DRAW)=>{const s=t.createBuffer();return t.bindBuffer(t.UNIFORM_BUFFER,s),t.bufferData(t.UNIFORM_BUFFER,e,a),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,i,s),s},Kt=kt,Pt=(t,e,i,a)=>{let s;switch(e){case t.FLOAT:return t.uniform1f(i,a);case t.FLOAT_VEC2:return s=a,t.uniform2f(i,s[0],s[1]);case t.FLOAT_VEC3:return s=a,t.uniform3f(i,s[0],s[1],s[2]);case t.FLOAT_VEC4:return s=a,t.uniform4f(i,s[0],s[1],s[2],s[3]);case t.BOOL:case t.INT:case t.SAMPLER_2D:case t.SAMPLER_CUBE:return t.uniform1i(i,a);case t.BOOL_VEC2:case t.INT_VEC2:return s=a,t.uniform2i(i,s[0],s[1]);case t.BOOL_VEC3:case t.INT_VEC3:return s=a,t.uniform3i(i,s[0],s[1],s[2]);case t.BOOL_VEC4:case t.INT_VEC4:return s=a,t.uniform4i(i,s[0],s[1],s[2],s[3]);case t.FLOAT_MAT2:return t.uniformMatrix2fv(i,!1,a);case t.FLOAT_MAT3:return t.uniformMatrix3fv(i,!1,a);case t.FLOAT_MAT4:return t.uniformMatrix4fv(i,!1,a);default:throw new Error("wrong type for uniform")}},st=Pt,Nt=(t={})=>{const{radius:e=.5,widthSegments:i=16,heightSegments:a=Math.ceil(i*.5),phiStart:s=0,phiLength:n=Math.PI*2,thetaStart:o=0,thetaLength:c=Math.PI}=t,u=i,l=a,m=s,d=n,f=o,h=c,_=(u+1)*(l+1),E=u*l*6,v=3+3+2,w=new Float32Array(_*v),D=_>65536?new Uint32Array(E):new Uint16Array(E);let T=0,S=0,p=0;const V=f+h,x=[],H=k();for(let y=0;y<=l;y++){const g=[],U=y/l;for(let b=0;b<=u;b++,T++){const F=b/u,R=-e*Math.cos(m+F*d)*Math.sin(f+U*h),$=e*Math.cos(f+U*h),z=e*Math.sin(m+F*d)*Math.sin(f+U*h);w[T*v+0]=R,w[T*v+1]=$,w[T*v+2]=z,rt(H,R,$,z),nt(H,H),w[T*v+3]=H[0],w[T*v+4]=H[1],w[T*v+5]=H[2],w[T*v+6]=F,w[T*v+7]=1-U,g.push(S++)}x.push(g)}for(let y=0;y<l;y++)for(let g=0;g<u;g++){const U=x[y][g+1],b=x[y][g],F=x[y+1][g],R=x[y+1][g+1];(y!==0||f>0)&&(D[p*3]=U,D[p*3+1]=b,D[p*3+2]=R,p++),(y!==l-1||V<Math.PI)&&(D[p*3]=b,D[p*3+1]=F,D[p*3+2]=R,p++)}return{radius:e,vertexCount:E,vertexStride:v,interleavedArray:w,indicesArray:D}},Zt=Nt,Ot=(t={})=>{const{width:e=1,height:i=1,widthSegments:a=1,heightSegments:s=1,flipUVy:n=!1}=t,o=a,c=s,u=(o+1)*(c+1),l=o*c*6,m=new Float32Array(u*3+u*2),d=u>65536?new Uint32Array(l):new Uint16Array(l);let f=0,h=0;const _=f,E=e/o,v=i/c,w=1,D=-1,T=0,S=3+2;for(let p=0;p<=c;p++){const V=p*v-i/2;for(let x=0;x<=o;x++,f++){const H=x*E-e/2;if(m[f*S+0]=H*w,m[f*S+1]=V*D,m[f*S+2]=T/2,m[f*S+3]=x/o,m[f*S+4]=n?1-p/c:p/c,p===c||x===o)continue;const y=_+x+p*(o+1),g=_+x+(p+1)*(o+1),U=_+x+(p+1)*(o+1)+1,b=_+x+p*(o+1)+1;d[h*6]=y,d[h*6+1]=g,d[h*6+2]=b,d[h*6+3]=g,d[h*6+4]=U,d[h*6+5]=b,h++}}return{width:e,height:i,vertexCount:d.length,vertexStride:S,interleavedArray:m,indicesArray:d}},Gt=Ot,Lt=(t={})=>{const{width:e=1,height:i=1,depth:a=1,widthSegments:s=1,heightSegments:n=1,depthSegments:o=1,uvOffsetEachFace:c=!1,flipUVy:u=!1}=t,l=s,m=n,d=o,f=(l+1)*(m+1)*2+(l+1)*(d+1)*2+(m+1)*(d+1)*2,h=(l*m*2+l*d*2+m*d*2)*6,_=3+3+2,E=new Float32Array(f*_),v=h>65536?new Uint32Array(h):new Uint16Array(h);let w=0,D=0;return L(E,v,a,i,e,d,m,4,2,1,0,-1,-1,w,D,_,c,u),L(E,v,a,i,-e,d,m,2,2,1,0,1,-1,w+=(d+1)*(m+1),D+=d*m,_,c,u),L(E,v,e,a,i,d,m,0,0,2,1,1,1,w+=(d+1)*(m+1),D+=d*m,_,c,u),L(E,v,e,a,-i,d,m,5,0,2,1,1,-1,w+=(l+1)*(d+1),D+=l*d,_,c,u),L(E,v,e,i,-a,l,m,3,0,1,2,-1,-1,w+=(l+1)*(d+1),D+=l*d,_,c,u),L(E,v,e,i,a,l,m,1,0,1,2,1,-1,w+=(l+1)*(m+1),D+=l*m,_,c,u),{width:e,height:i,depth:a,vertexCount:h,vertexStride:_,interleavedArray:E,indicesArray:v}},jt=Lt;function L(t,e,i,a,s,n,o,c,u=0,l=1,m=2,d=1,f=-1,h=0,_=0,E=8,v=!1,w=!1){const D=h,T=i/n,S=a/o;for(let p=0;p<=o;p++){const V=p*S-a/2;for(let x=0;x<=n;x++,h++){const H=x*T-i/2;t[h*E+0+u]=H*d,t[h*E+0+l]=V*f,t[h*E+0+m]=s/2,t[h*E+3+u]=0,t[h*E+3+l]=0,t[h*E+3+m]=s>=0?1:-1;const y=1/6,g=y*c,U=v?g+x/n*y:x/n,b=v?w?g+y-g+p/o*y:g+p/o*y:w?1-p/o:p/o;if(t[h*E+6+0]=U,t[h*E+6+1]=b,p===o||x===n)continue;const F=D+x+p*(n+1),R=D+x+(p+1)*(n+1),$=D+x+(p+1)*(n+1)+1,z=D+x+p*(n+1)+1;e[_*6]=F,e[_*6+1]=R,e[_*6+2]=z,e[_*6+3]=R,e[_*6+4]=$,e[_*6+5]=z,_++}}}var at=(t,e,i)=>Math.min(Math.max(t,e),i),lt=class{constructor(){r(this,"upVector",W(0,1,0));r(this,"position",W(0,0,0));r(this,"lookAt",W(0,0,0));r(this,"projectionMatrix",O());r(this,"viewMatrix",O());r(this,"viewMatrixInverse",O());r(this,"projectionViewMatrix",O())}updateViewMatrix(){return Mt(this.viewMatrix,this.position,this.lookAt,this.upVector),ct(this.viewMatrixInverse,this.viewMatrix),this}updateProjectionViewMatrix(){return ot(this.projectionViewMatrix,this.projectionMatrix,this.viewMatrix),this}},qt=class extends lt{constructor(t,e,i,a){super();r(this,"fieldOfView");r(this,"aspect");r(this,"near");r(this,"far");this.fieldOfView=t,this.aspect=e,this.near=i,this.far=a}updateProjectionMatrix(){return _t(this.projectionMatrix,this.fieldOfView,this.aspect,this.near,this.far),this}},Qt=class extends lt{constructor(t,e,i,a,s,n){super();r(this,"left");r(this,"right");r(this,"bottom");r(this,"top");r(this,"near");r(this,"far");this.left=t,this.right=e,this.top=i,this.bottom=a,this.near=s,this.far=n,this.updateProjectionMatrix()}updateProjectionMatrix(){return ft(this.projectionMatrix,this.left,this.right,this.bottom,this.top,this.near,this.far),this}},C=class{constructor(){r(this,"value",0);r(this,"damping");this.damping=.5}addForce(t){this.value+=t}update(){return this.value*this.value>1e-6?this.value*=this.damping:this.stop(),this.value}stop(){this.value=0}},Jt=class{constructor(t,e=document.body,i=!1,a=1){r(this,"camera");r(this,"domElement");r(this,"target",k());r(this,"minDistance",0);r(this,"maxDistance",1/0);r(this,"isEnabled",!0);r(this,"isDamping");r(this,"dampingFactor");r(this,"isZoom");r(this,"zoomSpeed");r(this,"isRotate");r(this,"rotateSpeed");r(this,"isPan");r(this,"keyPanSpeed");r(this,"enableKeys");r(this,"keys");r(this,"originTarget");r(this,"originPosition");r(this,"targetXDampedAction",new C);r(this,"targetYDampedAction",new C);r(this,"targetZDampedAction",new C);r(this,"targetThetaDampedAction",new C);r(this,"targetPhiDampedAction",new C);r(this,"targetRadiusDampedAction",new C);r(this,"_isShiftDown",!1);r(this,"_rotateStart",{x:9999,y:9999});r(this,"_rotateEnd",{x:9999,y:9999});r(this,"_roatteDelta",{x:9999,y:9999});r(this,"_spherical");r(this,"_zoomDistanceEnd",0);r(this,"_zoomDistance",0);r(this,"state","");r(this,"loopId",0);r(this,"_panStart",{x:0,y:0});r(this,"_panDelta",{x:0,y:0});r(this,"_panEnd",{x:0,y:0});r(this,"_paused",!1);r(this,"_isDebug",!1);r(this,"_outputEl");r(this,"mouseWheelForce",1);this.mouseWheelForce=a,t||console.error("camera is undefined"),this.camera=t,this.domElement=e,this.isDamping=!1,this.dampingFactor=.25,this.isZoom=!0,this.zoomSpeed=1,this.isRotate=!0,this.rotateSpeed=1,this.isPan=!0,this.keyPanSpeed=7,this.enableKeys=!0,this.keys={LEFT:"37",UP:"38",RIGHT:"39",BOTTOM:"40",SHIFT:"16"},this.originTarget=k(),this.originPosition=k(),this.originPosition[0]=t.position[0],this.originPosition[1]=t.position[0],this.originPosition[2]=t.position[0];const s=this.camera.position[0],n=this.camera.position[1],o=this.camera.position[2],c=Math.sqrt(s*s+n*n+o*o),u=Math.atan2(this.camera.position[0],this.camera.position[2]),l=Math.acos(at(this.camera.position[1]/c,-1,1));this._spherical={radius:c,theta:u,phi:l},this._bindEvens(),this.setEventHandler(),this.startTick(),this._isDebug=i,i&&(this._outputEl=document.createElement("div"),this._outputEl.setAttribute("style",`
      position: fixed;
      bottom: 24px;
      left: 24px;
      z-index: 999;
      font-family: monospace;
      font-size: 14px;
      user-select: none;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 4px;
      padding: 3px 6px;
    `),document.body.appendChild(this._outputEl))}lookAt([t,e,i]){return rt(this.target,t,e,i),this}setEventHandler(){this.domElement.addEventListener("contextmenu",this._contextMenuHandler,!1),this.domElement.addEventListener("mousedown",this._mouseDownHandler,!1),this.domElement.addEventListener("wheel",this._mouseWheelHandler,!1),this.domElement.addEventListener("touchstart",this._touchStartHandler,!1),this.domElement.addEventListener("touchmove",this._touchMoveHandler,!1),window.addEventListener("keydown",this._onKeyDownHandler,!1),window.addEventListener("keyup",this._onKeyUpHandler,!1)}removeEventHandler(){this.domElement.removeEventListener("contextmenu",this._contextMenuHandler,!1),this.domElement.removeEventListener("mousedown",this._mouseDownHandler,!1),this.domElement.removeEventListener("wheel",this._mouseWheelHandler,!1),this.domElement.removeEventListener("mousemove",this._mouseMoveHandler,!1),window.removeEventListener("mouseup",this._mouseUpHandler,!1),this.domElement.removeEventListener("touchstart",this._touchStartHandler,!1),this.domElement.removeEventListener("touchmove",this._touchMoveHandler,!1),window.removeEventListener("keydown",this._onKeyDownHandler,!1),window.removeEventListener("keydown",this._onKeyUpHandler,!1)}startTick(){this.loopId=requestAnimationFrame(this.tick)}pause(){this._paused=!0}start(){this._paused=!1}tick(){if(!this._paused&&(this.updateDampedAction(),this.updateCamera(),this._isDebug)){const t=Math.round(this.camera.position[0]*100)/100,e=Math.round(this.camera.position[1]*100)/100,i=Math.round(this.camera.position[2]*100)/100;this._outputEl.textContent=`x: ${t} y: ${e} z: ${i}`}this.loopId=requestAnimationFrame(this.tick)}updateDampedAction(){this.target[0]+=this.targetXDampedAction.update(),this.target[1]+=this.targetYDampedAction.update(),this.target[2]+=this.targetZDampedAction.update(),this._spherical.theta+=this.targetThetaDampedAction.update(),this._spherical.phi+=this.targetPhiDampedAction.update(),this._spherical.radius+=this.targetRadiusDampedAction.update()}updateCamera(){const t=this._spherical,e=Math.sin(t.phi)*t.radius;this.camera.position[0]=e*Math.sin(t.theta)+this.target[0],this.camera.position[1]=Math.cos(t.phi)*t.radius+this.target[1],this.camera.position[2]=e*Math.cos(t.theta)+this.target[2],this.camera.lookAt[0]=this.target[0],this.camera.lookAt[1]=this.target[1],this.camera.lookAt[2]=this.target[2]}_bindEvens(){this.tick=this.tick.bind(this),this._contextMenuHandler=this._contextMenuHandler.bind(this),this._mouseDownHandler=this._mouseDownHandler.bind(this),this._mouseWheelHandler=this._mouseWheelHandler.bind(this),this._mouseMoveHandler=this._mouseMoveHandler.bind(this),this._mouseUpHandler=this._mouseUpHandler.bind(this),this._touchStartHandler=this._touchStartHandler.bind(this),this._touchMoveHandler=this._touchMoveHandler.bind(this),this._onKeyDownHandler=this._onKeyDownHandler.bind(this),this._onKeyUpHandler=this._onKeyUpHandler.bind(this)}_contextMenuHandler(t){!this.isEnabled||t.preventDefault()}_mouseDownHandler(t){!this.isEnabled||(t.button===0?(this.state="rotate",this._rotateStart={x:t.clientX,y:t.clientY}):(this.state="pan",this._panStart={x:t.clientX,y:t.clientY}),this.domElement.addEventListener("mousemove",this._mouseMoveHandler,!1),window.addEventListener("mouseup",this._mouseUpHandler,!1))}_mouseUpHandler(){this.domElement.removeEventListener("mousemove",this._mouseMoveHandler,!1),window.removeEventListener("mouseup",this._mouseUpHandler,!1)}_mouseMoveHandler(t){!this.isEnabled||(this.state==="rotate"?(this._rotateEnd={x:t.clientX,y:t.clientY},this._roatteDelta={x:this._rotateEnd.x-this._rotateStart.x,y:this._rotateEnd.y-this._rotateStart.y},this._updateRotateHandler(),this._rotateStart={x:this._rotateEnd.x,y:this._rotateEnd.y}):this.state==="pan"&&(this._panEnd={x:t.clientX,y:t.clientY},this._panDelta={x:-.5*(this._panEnd.x-this._panStart.x),y:.5*(this._panEnd.y-this._panStart.y)},this._updatePanHandler(),this._panStart={x:this._panEnd.x,y:this._panEnd.y}))}_mouseWheelHandler(t){const e=this.mouseWheelForce;t.deltaY>0?this.targetRadiusDampedAction.addForce(e):this.targetRadiusDampedAction.addForce(-e)}_touchStartHandler(t){let e,i;switch(t.touches.length){case 1:this.state="rotate",this._rotateStart={x:t.touches[0].clientX,y:t.touches[0].clientY};break;case 2:this.state="zoom",e=t.touches[1].clientX-t.touches[0].clientX,i=t.touches[1].clientY-t.touches[0].clientY,this._zoomDistance=Math.sqrt(e*e+i*i);break;case 3:this.state="pan",this._panStart={x:(t.touches[0].clientX+t.touches[1].clientX+t.touches[2].clientX)/3,y:(t.touches[0].clientY+t.touches[1].clientY+t.touches[2].clientY)/3};break}}_touchMoveHandler(t){let e,i,a;switch(t.preventDefault(),t.touches.length){case 1:if(this.state!=="rotate")return;this._rotateEnd={x:t.touches[0].clientX,y:t.touches[0].clientY},this._roatteDelta={x:(this._rotateEnd.x-this._rotateStart.x)*.5,y:(this._rotateEnd.y-this._rotateStart.y)*.5},this._updateRotateHandler(),this._rotateStart={x:this._rotateEnd.x,y:this._rotateEnd.y};break;case 2:if(this.state!=="zoom")return;e=t.touches[1].clientX-t.touches[0].clientX,i=t.touches[1].clientY-t.touches[0].clientY,this._zoomDistanceEnd=Math.sqrt(e*e+i*i),a=this._zoomDistanceEnd-this._zoomDistance,a*=1.5;let s=this._spherical.radius-a;s=at(s,this.minDistance,this.maxDistance),this._zoomDistance=this._zoomDistanceEnd,this._spherical.radius=s;break;case 3:this._panEnd={x:(t.touches[0].clientX+t.touches[1].clientX+t.touches[2].clientX)/3,y:(t.touches[0].clientY+t.touches[1].clientY+t.touches[2].clientY)/3},this._panDelta={x:this._panEnd.x-this._panStart.x,y:this._panEnd.y-this._panStart.y},this._panDelta.x*=-1,this._updatePanHandler(),this._panStart={x:this._panEnd.x,y:this._panEnd.y};break}}_onKeyDownHandler(t){let e=0,i=0;switch(t.key){case this.keys.SHIFT:this._isShiftDown=!0;break;case this.keys.LEFT:e=-10;break;case this.keys.RIGHT:e=10;break;case this.keys.UP:i=10;break;case this.keys.BOTTOM:i=-10;break}this._isShiftDown?(this._roatteDelta={x:-e,y:i},this._updateRotateHandler()):(this._panDelta={x:e,y:i},this._updatePanHandler())}_onKeyUpHandler(t){switch(t.key){case this.keys.SHIFT:this._isShiftDown=!1;break}}_updatePanHandler(){const t=k(),e=k(),i=k();i[0]=this.target[0]-this.camera.position[0],i[1]=this.target[1]-this.camera.position[1],i[2]=this.target[2]-this.camera.position[2],nt(i,i),et(t,i,[0,1,0]),et(e,t,i);const a=Math.max(this._spherical.radius/2e3,.001);this.targetXDampedAction.addForce((t[0]*this._panDelta.x+e[0]*this._panDelta.y)*a),this.targetYDampedAction.addForce((t[1]*this._panDelta.x+e[1]*this._panDelta.y)*a),this.targetZDampedAction.addForce((t[2]*this._panDelta.x+e[2]*this._panDelta.y)*a)}_updateRotateHandler(){this.targetThetaDampedAction.addForce(-this._roatteDelta.x/this.domElement.clientWidth),this.targetPhiDampedAction.addForce(-this._roatteDelta.y/this.domElement.clientHeight)}},Ct=class{constructor(){r(this,"position",W(0,0,0));r(this,"rotation",W(0,0,0));r(this,"scale",W(1,1,1));r(this,"modelMatrix",O());r(this,"shouldUpdate",!0)}copyFromMatrix(t){return ht(this.modelMatrix,t),this.shouldUpdate=!1,this}setPosition(t){return j(this.position,t),this.shouldUpdate=!0,this}setScale(t){return j(this.scale,t),this.shouldUpdate=!0,this}setRotation(t){return j(this.rotation,t),this.shouldUpdate=!0,this}updateModelMatrix(){return vt(this.modelMatrix),wt(this.modelMatrix,this.modelMatrix,this.position),Dt(this.modelMatrix,this.modelMatrix,this.rotation[0]),yt(this.modelMatrix,this.modelMatrix,this.rotation[1]),gt(this.modelMatrix,this.modelMatrix,this.rotation[2]),At(this.modelMatrix,this.modelMatrix,this.scale),this.shouldUpdate=!1,this}},Xt=class extends Ct{constructor(t=void 0){super();r(this,"parentNode",null);r(this,"_children",[]);r(this,"_visible",!0);r(this,"worldMatrix",O());r(this,"normalMatrix",O());r(this,"uid",xt(9));r(this,"name");this.name=t}get visible(){return this._visible}set visible(t){this._visible=t}get children(){return this._children}get siblings(){return this.parentNode?this.parentNode._children:[]}get levelIndex(){let t=0,e=this.parentNode;for(;e;)t++,e=e.parentNode;return t}setParent(t=null){if(this.parentNode){const e=this.parentNode._children.indexOf(this);e>=0&&this.parentNode._children.splice(e,1)}return t&&t.addChild(this),this.parentNode=t,this}addChild(t){return this._children.push(t),this}updateWorldMatrix(t=null){this.shouldUpdate&&this.updateModelMatrix(),t?ot(this.worldMatrix,t,this.modelMatrix):ht(this.worldMatrix,this.modelMatrix),ct(this.normalMatrix,this.worldMatrix),Et(this.normalMatrix,this.normalMatrix);for(let e=0;e<this._children.length;e++)this._children[e].updateWorldMatrix(this.worldMatrix);return this}traverse(t,e=0){t(this,e),e++;for(let i=0;i<this._children.length;i++)this._children[i].traverse(t,e)}findChild(t){if(t(this))return this;let e=null;for(let i=0;i<this._children.length&&!(e=this._children[i].findChild(t));i++);return e}findChildByName(t){if(this.name===t)return this;let e=null;for(let i=0;i<this._children.length&&!(e=this._children[i].findChildByName(t));i++);return e}findParent(t){if(t(this))return this;let e=null,i=this.parentNode;for(;i&&!(e=i.findParent(t));)i=i==null?void 0:i.parentNode;return e}findParentByName(t){if(this.name===t)return this;let e=null,i=this.parentNode;for(;i&&!(e=i.findParentByName(t));)i=i==null?void 0:i.parentNode;return e}render(){if(!!this._visible)for(let t=0;t<this._children.length;t++)this._children[t].render()}},X,G=class extends Xt{constructor(t,e,i,a={},s){super(s);if(N(this,"gl"),N(this,"vao"),N(this,"vertexCount"),Z(this,X,new Map),N(this,"boundingBox"),N(this,"program"),this.gl=t,this.vao=t.createVertexArray(),this.program=It(t,e,i,a),this.program.__SPECTOR_Metadata={name:s,shaderDefines:a},!this.setUniform(G.WORLD_MATRIX_UNIFORM_NAME,{type:t.FLOAT_MAT4}))throw new Error(`Each Drawable is expected to have a mat4 ${G.WORLD_MATRIX_UNIFORM_NAME} implemented in shader`)}setUniform(t,{type:e,value:i}){const a=this.gl;let s;if(s=A(this,X).get(t))s.value=i;else{const n=a.getUniformLocation(this.program,t);if(!n)return console.error(`uniform with name ${t} was not found in the program`),!1;s={type:e,location:n,value:i},A(this,X).set(t,s)}return i!=null&&(a.useProgram(this.program),st(a,s.type,s.location,i)),!0}updateUniform(t,e){let i;if(i=this.getUniform(t)){i.value=e;const a=this.gl;return a.useProgram(this.program),st(a,i.type,i.location,e),!0}return!1}getUniform(t){let e;return(e=A(this,X).get(t))?e:(console.error("can't locate uniform with that name"),null)}updateWorldMatrix(t){return super.updateWorldMatrix(t),this.updateUniform(G.WORLD_MATRIX_UNIFORM_NAME,this.worldMatrix),this}destroy(){A(this,X).clear();const t=this.gl;t.deleteVertexArray(this.vao),t.deleteProgram(this.program)}},Bt=G;X=new WeakMap;N(Bt,"WORLD_MATRIX_UNIFORM_NAME","u_worldMatrix");var Yt=document.createElement("canvas"),ut=Yt.getContext("webgl2"),I=ut.MAX_TEXTURE_SIZE,K=ut.RGB,Q,M,J=!1,P,B,Y,tt=class{constructor(){if(Z(this,P,[]),Z(this,B,[]),Z(this,Y,document.createElement("div")),J){const e=document.createElement("style"),i="hwoa-rang-texture-atlas-debug";e.setAttribute("type","text/css");const a=`
        #${i} {
          position: fixed;
          bottom: 1rem;
          right: 1rem;
          transform-origin: 100% 100%;
          width: ${400}px;
          max-height: 100vh;
          overflow: scroll;
        }
        #${i} canvas {
          max-width: 100%;
        }
      `;e.appendChild(document.createTextNode(a)),document.getElementsByTagName("head")[0].appendChild(e),Ht(this,Y,document.createElement("div")),A(this,Y).setAttribute("id",i),document.body.appendChild(A(this,Y))}}static set debugMode(t){J=t}static get textureSize(){return I}static set textureSize(t){I=t}static set textureFormat(t){K=t}static set gl(t){M=t}static getInstance(){if(!M)throw new Error("You must provide a WebGL2RenderingContext first via setting the TextureAtlas.gl property!");return Q||(Q=new tt),Q}pack(t,e,i=1){const a=()=>{const h=document.createElement("canvas");A(this,Y).appendChild(h),h.width=I,h.height=I;const _=M.createTexture();M.bindTexture(M.TEXTURE_2D,_),M.texParameterf(M.TEXTURE_2D,M.TEXTURE_MIN_FILTER,M.LINEAR_MIPMAP_LINEAR),M.texImage2D(M.TEXTURE_2D,0,K,I,I,0,K,M.UNSIGNED_BYTE,null),M.generateMipmap(M.TEXTURE_2D),M.bindTexture(M.TEXTURE_2D,null);const E=new Tt(h);return A(this,P).push(E),A(this,B).push(_),E};let s=A(this,P)[A(this,P).length-1];s||(s=a());const n=i===1?e:tt.scaleDownDrawableByFactor(e,i);s.pack(t,n)||(s=a(),s.pack(t,n));const c=s.uv()[t];for(let h=0;h<c.length;h++)c[h][0]*=I,c[h][1]*=I;const u=A(this,B)[A(this,B).length-1],l=c[0][0],m=c[0][1],d=c[2][0]-c[0][0],f=c[2][1]-c[0][1];return M.bindTexture(M.TEXTURE_2D,u),M.texSubImage2D(M.TEXTURE_2D,0,l,m,d,f,K,M.UNSIGNED_BYTE,n),M.generateMipmap(M.TEXTURE_2D),M.bindTexture(M.TEXTURE_2D,null),this}getUv2(t){let e=-1;for(let i=0;i<A(this,P).length;i++){const s=A(this,P)[i].uv2()[t];if(s){e=i;const n=A(this,B)[e];return[s,n]}}throw new Error("Can't get uvs")}},Wt=tt;P=new WeakMap;B=new WeakMap;Y=new WeakMap;N(Wt,"scaleDownDrawableByFactor",(t,e)=>{const i=document.createElement("canvas"),a=t instanceof HTMLImageElement?t.naturalWidth:t.width,s=t instanceof HTMLImageElement?t.naturalHeight:t.height;i.width=a/e,i.height=s/e,J&&console.log(`Scaled ${a}x${s} project image to ${i.width}x${i.height}`);const n=i.getContext("2d");return n.imageSmoothingQuality="high",n.drawImage(t,0,0,a,s,0,0,i.width,i.height),i});export{Jt as C,Bt as D,Qt as O,qt as P,Xt as S,Gt as a,$t as b,Zt as c,Kt as d,jt as e};
