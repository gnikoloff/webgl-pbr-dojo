function p(){var n=document.createElement("canvas"),m="t",s=1,l=2.2,a=null,t,i;return n.__defineGetter__("exposure",function(){return s}),n.__defineSetter__("exposure",function(h){s=h,a&&(D(a,s,l,i.data),t.putImageData(i,0,0))}),n.__defineGetter__("gamma",function(){return l}),n.__defineSetter__("gamma",function(h){l=h,a&&(D(a,s,l,i.data),t.putImageData(i,0,0))}),n.__defineGetter__("dataFloat",function(){return b(a)}),n.__defineGetter__("dataRGBE",function(){return a}),n.toHDRBlob=function(h,o,T){function d(E,M,U){var w=E.createShader(U);return E.shaderSource(w,M),E.compileShader(w),w}function g(E,M,U){var w=E.createProgram(),F,S;return E.attachShader(w,F=d(E,M,E.VERTEX_SHADER)),E.attachShader(w,S=d(E,U,E.FRAGMENT_SHADER)),E.linkProgram(w),E.deleteShader(F),E.deleteShader(S),w}var f=o&&o.match(/rgb9_e5/i)?new Uint8Array(I(b(a)).buffer):new Uint8Array(a.buffer),_=`precision highp float;
attribute vec3 position;
varying vec2 tex;
void main() { tex = position.xy/2.0+0.5; gl_Position = vec4(position, 1.0); }`,u=`precision highp float;
precision highp sampler2D;
uniform sampler2D tx;
varying vec2 tex;
void main() { gl_FragColor = texture2D(tx,tex); }`,R=this.width,A=this.height;if(R*A*4<f.byteLength)return console.error("not big enough.");var c=document.createElement("canvas");c.width=R,c.height=A;var r=c.getContext("webgl",{antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),y=r.createTexture();r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,y),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,R,A,0,r.RGBA,r.UNSIGNED_BYTE,new Uint8Array(f.buffer));var v=g(r,_,u),x=r.getUniformLocation(v,"tx"),L=new Float32Array([-1,-1,0,1,-1,0,1,1,0,1,1,0,-1,1,0,-1,-1,0]),C=r.createBuffer();if(r.enableVertexAttribArray(0),r.bindBuffer(r.ARRAY_BUFFER,C),r.bufferData(r.ARRAY_BUFFER,L,r.STATIC_DRAW),r.vertexAttribPointer(0,3,r.FLOAT,!1,0,0),r.useProgram(v),r.uniform1i(x,0),r.drawArrays(r.TRIANGLES,0,6),r.deleteTexture(y),r.deleteProgram(v),h)return c.toBlob(h)},n.__defineGetter__("src",function(){return m}),n.__defineSetter__("src",function(h){if(m=h,t&&t.clearRect(0,0,this.width,this.height),h.match(/\.hdr$/i))X(h,function(T,d,g){a=T,this.width=this.style.width=d,this.height=this.style.height=g,t=this.getContext("2d"),i=t.getImageData(0,0,d,g),D(T,s,l,i.data),t.putImageData(i,0,0),this.onload&&this.onload()}.bind(n));else if(h.match(/\.rgb9_e5\.png$/i)){var o=new Image;o.src=h,o.onload=function(){var T=document.createElement("canvas"),d=this.width=this.style.width=T.width=o.width,g=this.height=this.style.height=T.height=o.height,f=T.getContext("webgl"),_=f.createTexture();f.bindTexture(f.TEXTURE_2D,_),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,o),fb=f.createFramebuffer(),f.bindFramebuffer(f.FRAMEBUFFER,fb),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,_,0);var u=new Uint8Array(d*g*4);f.readPixels(0,0,d,g,f.RGBA,f.UNSIGNED_BYTE,u),f.deleteTexture(_),f.deleteFramebuffer(fb),this.dataRAW=new Uint32Array(u.buffer),a=G(B(this.dataRAW)),t=this.getContext("2d"),i=t.getImageData(0,0,d,g),D(a,s,l,i.data),t.putImageData(i,0,0),this.onload&&this.onload()}.bind(n)}else if(h.match(/\.hdr\.png$|\.rgbe\.png/i)){var o=new Image;o.src=h,o.onload=function(){var d=document.createElement("canvas"),g=this.width=this.style.width=d.width=o.width,f=this.height=this.style.height=d.height=o.height,_=d.getContext("webgl"),u=_.createTexture();_.bindTexture(_.TEXTURE_2D,u),_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,o),fb=_.createFramebuffer(),_.bindFramebuffer(_.FRAMEBUFFER,fb),_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,u,0);var R=new Uint8Array(g*f*4);_.readPixels(0,0,g,f,_.RGBA,_.UNSIGNED_BYTE,R),_.deleteTexture(u),_.deleteFramebuffer(fb),a=R,t=this.getContext("2d"),i=t.getImageData(0,0,g,f),D(a,s,l,i.data),t.putImageData(i,0,0),this.onload&&this.onload()}.bind(n)}}),n}function P(n,m){for(var s in m)n[s]=m[s];return n}function X(n,m){var s=P(new XMLHttpRequest,{responseType:"arraybuffer"});return s.onerror=m.bind(s,!1),s.onload=function(){if(this.status>=400)return this.onerror();for(var l="",a=0,t=new Uint8Array(this.response),i;!l.match(/\n\n[^\n]+\n/g);)l+=String.fromCharCode(t[a++]);if(i=l.match(/FORMAT=(.*)$/m)[1],i!="32-bit_rle_rgbe")return console.warn("unknown format : "+i),this.onerror();for(var h=l.split(/\n/).reverse()[1].split(" "),o=h[3]*1,T=h[1]*1,d=new Uint8Array(o*T*4),g=0,f=0;f<T;f++){var _=t.slice(a,a+=4),u=[];if(_[0]!=2||_[1]!=2||_[2]&128){var R=o,A=0;for(a-=4;R>0;)if(d.set(t.slice(a,a+=4),g),d[g]==1&&d[g+1]==1&&d[g+2]==1){for(d[g+3]<<A;c>0;c--)d.set(d.slice(g-4,g),g),g+=4,R--;A+=8}else R--,g+=4,A=0}else{if((_[2]<<8)+_[3]!=o)return console.warn("HDR line mismatch .."),this.onerror();for(var c=0;c<4;c++)for(var r=c*o,y=(c+1)*o,v,x;r<y;)if(v=t.slice(a,a+=2),v[0]>128)for(x=v[0]-128;x-- >0;)u[r++]=v[1];else for(x=v[0]-1,u[r++]=v[1];x-- >0;)u[r++]=t[a++];for(var c=0;c<o;c++)d[g++]=u[c],d[g++]=u[c+o],d[g++]=u[c+2*o],d[g++]=u[c+3*o]}}m&&m(d,o,T)},s.open("GET",n,!0),s.send(null),s}function I(n,T){for(var s,l,a,t,i,h,o=n.byteLength/12|0,T=T||new Uint32Array(o),d=0;d<o;d++)s=Math.min(32768,n[d*3]),l=Math.min(32768,n[d*3+1]),a=Math.min(32768,n[d*3+2]),t=Math.max(Math.max(s,l),a),i=Math.max(-16,Math.floor(Math.log2(t)))+16,h=Math.pow(2,i-24),Math.floor(t/h+.5)==511&&(h*=2,i+=1),T[d]=(Math.floor(s/h+.5)<<23)+(Math.floor(l/h+.5)<<14)+(Math.floor(a/h+.5)<<5)+(i|0);return T}function B(n,t){for(var s,l,a=n.byteLength>>2,t=t||new Float32Array(a*3),i=0;i<a;i++)s=n[i],l=Math.pow(2,(s&31)-24),t[i*3]=(s>>>23)*l,t[i*3+1]=(s>>>14&511)*l,t[i*3+2]=(s>>>5&511)*l;return t}function G(n,o){for(var s,l,a,t,i,h=n.byteLength/12|0,o=o||new Uint8Array(h*4),T=0;T<h;T++)s=n[T*3],l=n[T*3+1],a=n[T*3+2],t=Math.max(Math.max(s,l),a),e=Math.ceil(Math.log2(t)),i=Math.pow(2,e-8),o[T*4]=s/i|0,o[T*4+1]=l/i|0,o[T*4+2]=a/i|0,o[T*4+3]=e+128;return o}function b(n,a){for(var s,l=n.byteLength>>2,a=a||new Float32Array(l*3),t=0;t<l;t++)s=Math.pow(2,n[t*4+3]-(128+8)),a[t*3]=n[t*4]*s,a[t*3+1]=n[t*4+1]*s,a[t*3+2]=n[t*4+2]*s;return a}function D(n,m,s,h){m=Math.pow(2,m===void 0?1:m)/2,s===void 0&&(s=2.2);for(var a=1/s,t,i=n.byteLength>>2,h=h||new Uint8ClampedArray(i*4),o=0;o<i;o++)t=m*Math.pow(2,n[o*4+3]-(128+8)),h[o*4]=255*Math.pow(n[o*4]*t,a),h[o*4+1]=255*Math.pow(n[o*4+1]*t,a),h[o*4+2]=255*Math.pow(n[o*4+2]*t,a),h[o*4+3]=255;return h}function N(n,m,s,i){m=Math.pow(2,m===void 0?1:m)/2,s===void 0&&(s=2.2);for(var a=1/s,t=n.byteLength/12|0,i=i||new Uint8ClampedArray(t*4),h=0;h<t;h++)i[h*4]=255*Math.pow(n[h*3]*m,a),i[h*4+1]=255*Math.pow(n[h*3+1]*m,a),i[h*4+2]=255*Math.pow(n[h*3+2]*m,a),i[h*4+3]=255;return i}p.floatToRgbe=G;p.rgbeToFloat=b;p.floatToRgb9_e5=I;p.rgb9_e5ToFloat=B;p.rgbeToLDR=D;p.floatToLDR=N;var H="/A_little_paris_eiffel_tower_1k.hdr",k="/A_moonlit_golf_1k.hdr",O="/A_qwantani_moon_noon_puresky_1k.hdr",Y="/little_paris_eiffel_tower.png",W="/moonlit_golf.png",q="/qwantani_moon_noon_puresky_1k.png";export{p as H,q as a,H as b,O as c,W as d,k as h,Y as s};
