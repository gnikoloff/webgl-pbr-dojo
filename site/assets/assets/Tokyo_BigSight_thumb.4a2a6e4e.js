function p(){var n=document.createElement("canvas"),m="t",s=1,l=2.2,a=null,t,h;return n.__defineGetter__("exposure",function(){return s}),n.__defineSetter__("exposure",function(i){s=i,a&&(D(a,s,l,h.data),t.putImageData(h,0,0))}),n.__defineGetter__("gamma",function(){return l}),n.__defineSetter__("gamma",function(i){l=i,a&&(D(a,s,l,h.data),t.putImageData(h,0,0))}),n.__defineGetter__("dataFloat",function(){return U(a)}),n.__defineGetter__("dataRGBE",function(){return a}),n.toHDRBlob=function(i,o,g){function d(E,M,b){var A=E.createShader(b);return E.shaderSource(A,M),E.compileShader(A),A}function T(E,M,b){var A=E.createProgram(),F,S;return E.attachShader(A,F=d(E,M,E.VERTEX_SHADER)),E.attachShader(A,S=d(E,b,E.FRAGMENT_SHADER)),E.linkProgram(A),E.deleteShader(F),E.deleteShader(S),A}var f=o&&o.match(/rgb9_e5/i)?new Uint8Array(I(U(a)).buffer):new Uint8Array(a.buffer),_=`precision highp float;
attribute vec3 position;
varying vec2 tex;
void main() { tex = position.xy/2.0+0.5; gl_Position = vec4(position, 1.0); }`,c=`precision highp float;
precision highp sampler2D;
uniform sampler2D tx;
varying vec2 tex;
void main() { gl_FragColor = texture2D(tx,tex); }`,R=this.width,w=this.height;if(R*w*4<f.byteLength)return console.error("not big enough.");var u=document.createElement("canvas");u.width=R,u.height=w;var r=u.getContext("webgl",{antialias:!1,alpha:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),y=r.createTexture();r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,y),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,R,w,0,r.RGBA,r.UNSIGNED_BYTE,new Uint8Array(f.buffer));var v=T(r,_,c),x=r.getUniformLocation(v,"tx"),L=new Float32Array([-1,-1,0,1,-1,0,1,1,0,1,1,0,-1,1,0,-1,-1,0]),C=r.createBuffer();if(r.enableVertexAttribArray(0),r.bindBuffer(r.ARRAY_BUFFER,C),r.bufferData(r.ARRAY_BUFFER,L,r.STATIC_DRAW),r.vertexAttribPointer(0,3,r.FLOAT,!1,0,0),r.useProgram(v),r.uniform1i(x,0),r.drawArrays(r.TRIANGLES,0,6),r.deleteTexture(y),r.deleteProgram(v),i)return u.toBlob(i)},n.__defineGetter__("src",function(){return m}),n.__defineSetter__("src",function(i){if(m=i,t&&t.clearRect(0,0,this.width,this.height),i.match(/\.hdr$/i))X(i,function(g,d,T){a=g,this.width=this.style.width=d,this.height=this.style.height=T,t=this.getContext("2d"),h=t.getImageData(0,0,d,T),D(g,s,l,h.data),t.putImageData(h,0,0),this.onload&&this.onload()}.bind(n));else if(i.match(/\.rgb9_e5\.png$/i)){var o=new Image;o.src=i,o.onload=function(){var g=document.createElement("canvas"),d=this.width=this.style.width=g.width=o.width,T=this.height=this.style.height=g.height=o.height,f=g.getContext("webgl"),_=f.createTexture();f.bindTexture(f.TEXTURE_2D,_),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,o),fb=f.createFramebuffer(),f.bindFramebuffer(f.FRAMEBUFFER,fb),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,_,0);var c=new Uint8Array(d*T*4);f.readPixels(0,0,d,T,f.RGBA,f.UNSIGNED_BYTE,c),f.deleteTexture(_),f.deleteFramebuffer(fb),this.dataRAW=new Uint32Array(c.buffer),a=G(B(this.dataRAW)),t=this.getContext("2d"),h=t.getImageData(0,0,d,T),D(a,s,l,h.data),t.putImageData(h,0,0),this.onload&&this.onload()}.bind(n)}else if(i.match(/\.hdr\.png$|\.rgbe\.png/i)){var o=new Image;o.src=i,o.onload=function(){var d=document.createElement("canvas"),T=this.width=this.style.width=d.width=o.width,f=this.height=this.style.height=d.height=o.height,_=d.getContext("webgl"),c=_.createTexture();_.bindTexture(_.TEXTURE_2D,c),_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,o),fb=_.createFramebuffer(),_.bindFramebuffer(_.FRAMEBUFFER,fb),_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,c,0);var R=new Uint8Array(T*f*4);_.readPixels(0,0,T,f,_.RGBA,_.UNSIGNED_BYTE,R),_.deleteTexture(c),_.deleteFramebuffer(fb),a=R,t=this.getContext("2d"),h=t.getImageData(0,0,T,f),D(a,s,l,h.data),t.putImageData(h,0,0),this.onload&&this.onload()}.bind(n)}}),n}function P(n,m){for(var s in m)n[s]=m[s];return n}function X(n,m){var s=P(new XMLHttpRequest,{responseType:"arraybuffer"});return s.onerror=m.bind(s,!1),s.onload=function(){if(this.status>=400)return this.onerror();for(var l="",a=0,t=new Uint8Array(this.response),h;!l.match(/\n\n[^\n]+\n/g);)l+=String.fromCharCode(t[a++]);if(h=l.match(/FORMAT=(.*)$/m)[1],h!="32-bit_rle_rgbe")return console.warn("unknown format : "+h),this.onerror();for(var i=l.split(/\n/).reverse()[1].split(" "),o=i[3]*1,g=i[1]*1,d=new Uint8Array(o*g*4),T=0,f=0;f<g;f++){var _=t.slice(a,a+=4),c=[];if(_[0]!=2||_[1]!=2||_[2]&128){var R=o,w=0;for(a-=4;R>0;)if(d.set(t.slice(a,a+=4),T),d[T]==1&&d[T+1]==1&&d[T+2]==1){for(d[T+3]<<w;u>0;u--)d.set(d.slice(T-4,T),T),T+=4,R--;w+=8}else R--,T+=4,w=0}else{if((_[2]<<8)+_[3]!=o)return console.warn("HDR line mismatch .."),this.onerror();for(var u=0;u<4;u++)for(var r=u*o,y=(u+1)*o,v,x;r<y;)if(v=t.slice(a,a+=2),v[0]>128)for(x=v[0]-128;x-- >0;)c[r++]=v[1];else for(x=v[0]-1,c[r++]=v[1];x-- >0;)c[r++]=t[a++];for(var u=0;u<o;u++)d[T++]=c[u],d[T++]=c[u+o],d[T++]=c[u+2*o],d[T++]=c[u+3*o]}}m&&m(d,o,g)},s.open("GET",n,!0),s.send(null),s}function I(n,g){for(var s,l,a,t,h,i,o=n.byteLength/12|0,g=g||new Uint32Array(o),d=0;d<o;d++)s=Math.min(32768,n[d*3]),l=Math.min(32768,n[d*3+1]),a=Math.min(32768,n[d*3+2]),t=Math.max(Math.max(s,l),a),h=Math.max(-16,Math.floor(Math.log2(t)))+16,i=Math.pow(2,h-24),Math.floor(t/i+.5)==511&&(i*=2,h+=1),g[d]=(Math.floor(s/i+.5)<<23)+(Math.floor(l/i+.5)<<14)+(Math.floor(a/i+.5)<<5)+(h|0);return g}function B(n,t){for(var s,l,a=n.byteLength>>2,t=t||new Float32Array(a*3),h=0;h<a;h++)s=n[h],l=Math.pow(2,(s&31)-24),t[h*3]=(s>>>23)*l,t[h*3+1]=(s>>>14&511)*l,t[h*3+2]=(s>>>5&511)*l;return t}function G(n,o){for(var s,l,a,t,h,i=n.byteLength/12|0,o=o||new Uint8Array(i*4),g=0;g<i;g++)s=n[g*3],l=n[g*3+1],a=n[g*3+2],t=Math.max(Math.max(s,l),a),e=Math.ceil(Math.log2(t)),h=Math.pow(2,e-8),o[g*4]=s/h|0,o[g*4+1]=l/h|0,o[g*4+2]=a/h|0,o[g*4+3]=e+128;return o}function U(n,a){for(var s,l=n.byteLength>>2,a=a||new Float32Array(l*3),t=0;t<l;t++)s=Math.pow(2,n[t*4+3]-(128+8)),a[t*3]=n[t*4]*s,a[t*3+1]=n[t*4+1]*s,a[t*3+2]=n[t*4+2]*s;return a}function D(n,m,s,i){m=Math.pow(2,m===void 0?1:m)/2,s===void 0&&(s=2.2);for(var a=1/s,t,h=n.byteLength>>2,i=i||new Uint8ClampedArray(h*4),o=0;o<h;o++)t=m*Math.pow(2,n[o*4+3]-(128+8)),i[o*4]=255*Math.pow(n[o*4]*t,a),i[o*4+1]=255*Math.pow(n[o*4+1]*t,a),i[o*4+2]=255*Math.pow(n[o*4+2]*t,a),i[o*4+3]=255;return i}function N(n,m,s,h){m=Math.pow(2,m===void 0?1:m)/2,s===void 0&&(s=2.2);for(var a=1/s,t=n.byteLength/12|0,h=h||new Uint8ClampedArray(t*4),i=0;i<t;i++)h[i*4]=255*Math.pow(n[i*3]*m,a),h[i*4+1]=255*Math.pow(n[i*3+1]*m,a),h[i*4+2]=255*Math.pow(n[i*3+2]*m,a),h[i*4+3]=255;return h}p.floatToRgbe=G;p.rgbeToFloat=U;p.floatToRgb9_e5=I;p.rgb9_e5ToFloat=B;p.rgbeToLDR=D;p.floatToLDR=N;var H="/MonValley_A_LookoutPoint_2k.hdr",k="/MonValley_A_LookoutPoint_Thumb.jpg",O="/Theatre-Center_2k.hdr",Y="/Theatre-Center_Thumb.jpg",W="/Tokyo_BigSight_3k.hdr",V="/Tokyo_BigSight_thumb.jpg";export{p as H,V as a,O as b,W as c,k as d,H as h,Y as s};
