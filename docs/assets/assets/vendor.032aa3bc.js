var C=1e-6,S=typeof Float32Array!="undefined"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function o(){var r=new S(16);return S!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function u(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function H(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function rr(r,e){if(r===e){var n=e[1],t=e[2],i=e[3],s=e[6],h=e[7],a=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=n,r[6]=e[9],r[7]=e[13],r[8]=t,r[9]=s,r[11]=e[14],r[12]=i,r[13]=h,r[14]=a}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function er(r,e){var n=e[0],t=e[1],i=e[2],s=e[3],h=e[4],a=e[5],v=e[6],c=e[7],l=e[8],f=e[9],p=e[10],d=e[11],N=e[12],g=e[13],M=e[14],m=e[15],A=n*a-t*h,y=n*v-i*h,w=n*c-s*h,_=t*v-i*a,x=t*c-s*a,b=i*c-s*v,z=l*g-f*N,U=l*M-p*N,R=l*m-d*N,O=f*M-p*g,E=f*m-d*g,F=p*m-d*M,k=A*F-y*E+w*O+_*R-x*U+b*z;return k?(k=1/k,r[0]=(a*F-v*E+c*O)*k,r[1]=(i*E-t*F-s*O)*k,r[2]=(g*b-M*x+m*_)*k,r[3]=(p*x-f*b-d*_)*k,r[4]=(v*R-h*F-c*U)*k,r[5]=(n*F-i*R+s*U)*k,r[6]=(M*w-N*b-m*y)*k,r[7]=(l*b-p*w+d*y)*k,r[8]=(h*E-a*R+c*z)*k,r[9]=(t*R-n*E-s*z)*k,r[10]=(N*x-g*w+m*A)*k,r[11]=(f*w-l*x-d*A)*k,r[12]=(a*U-h*O-v*z)*k,r[13]=(n*O-t*U+i*z)*k,r[14]=(g*y-N*_-M*A)*k,r[15]=(l*_-f*y+p*A)*k,r):null}function L(r,e,n){var t=e[0],i=e[1],s=e[2],h=e[3],a=e[4],v=e[5],c=e[6],l=e[7],f=e[8],p=e[9],d=e[10],N=e[11],g=e[12],M=e[13],m=e[14],A=e[15],y=n[0],w=n[1],_=n[2],x=n[3];return r[0]=y*t+w*a+_*f+x*g,r[1]=y*i+w*v+_*p+x*M,r[2]=y*s+w*c+_*d+x*m,r[3]=y*h+w*l+_*N+x*A,y=n[4],w=n[5],_=n[6],x=n[7],r[4]=y*t+w*a+_*f+x*g,r[5]=y*i+w*v+_*p+x*M,r[6]=y*s+w*c+_*d+x*m,r[7]=y*h+w*l+_*N+x*A,y=n[8],w=n[9],_=n[10],x=n[11],r[8]=y*t+w*a+_*f+x*g,r[9]=y*i+w*v+_*p+x*M,r[10]=y*s+w*c+_*d+x*m,r[11]=y*h+w*l+_*N+x*A,y=n[12],w=n[13],_=n[14],x=n[15],r[12]=y*t+w*a+_*f+x*g,r[13]=y*i+w*v+_*p+x*M,r[14]=y*s+w*c+_*d+x*m,r[15]=y*h+w*l+_*N+x*A,r}function ir(r,e,n){var t=n[0],i=n[1],s=n[2],h,a,v,c,l,f,p,d,N,g,M,m;return e===r?(r[12]=e[0]*t+e[4]*i+e[8]*s+e[12],r[13]=e[1]*t+e[5]*i+e[9]*s+e[13],r[14]=e[2]*t+e[6]*i+e[10]*s+e[14],r[15]=e[3]*t+e[7]*i+e[11]*s+e[15]):(h=e[0],a=e[1],v=e[2],c=e[3],l=e[4],f=e[5],p=e[6],d=e[7],N=e[8],g=e[9],M=e[10],m=e[11],r[0]=h,r[1]=a,r[2]=v,r[3]=c,r[4]=l,r[5]=f,r[6]=p,r[7]=d,r[8]=N,r[9]=g,r[10]=M,r[11]=m,r[12]=h*t+l*i+N*s+e[12],r[13]=a*t+f*i+g*s+e[13],r[14]=v*t+p*i+M*s+e[14],r[15]=c*t+d*i+m*s+e[15]),r}function tr(r,e,n){var t=n[0],i=n[1],s=n[2];return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*s,r[9]=e[9]*s,r[10]=e[10]*s,r[11]=e[11]*s,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function nr(r,e,n){var t=Math.sin(n),i=Math.cos(n),s=e[4],h=e[5],a=e[6],v=e[7],c=e[8],l=e[9],f=e[10],p=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=s*i+c*t,r[5]=h*i+l*t,r[6]=a*i+f*t,r[7]=v*i+p*t,r[8]=c*i-s*t,r[9]=l*i-h*t,r[10]=f*i-a*t,r[11]=p*i-v*t,r}function sr(r,e,n){var t=Math.sin(n),i=Math.cos(n),s=e[0],h=e[1],a=e[2],v=e[3],c=e[8],l=e[9],f=e[10],p=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i-c*t,r[1]=h*i-l*t,r[2]=a*i-f*t,r[3]=v*i-p*t,r[8]=s*t+c*i,r[9]=h*t+l*i,r[10]=a*t+f*i,r[11]=v*t+p*i,r}function hr(r,e,n){var t=Math.sin(n),i=Math.cos(n),s=e[0],h=e[1],a=e[2],v=e[3],c=e[4],l=e[5],f=e[6],p=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i+c*t,r[1]=h*i+l*t,r[2]=a*i+f*t,r[3]=v*i+p*t,r[4]=c*i-s*t,r[5]=l*i-h*t,r[6]=f*i-a*t,r[7]=p*i-v*t,r}function V(r,e,n,t,i){var s=1/Math.tan(e/2),h;return r[0]=s/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0?(h=1/(t-i),r[10]=(i+t)*h,r[14]=2*i*t*h):(r[10]=-1,r[14]=-2*t),r}var ar=V;function G(r,e,n,t,i,s,h){var a=1/(e-n),v=1/(t-i),c=1/(s-h);return r[0]=-2*a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*v,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*c,r[11]=0,r[12]=(e+n)*a,r[13]=(i+t)*v,r[14]=(h+s)*c,r[15]=1,r}var vr=G;function cr(r,e,n,t){var i,s,h,a,v,c,l,f,p,d,N=e[0],g=e[1],M=e[2],m=t[0],A=t[1],y=t[2],w=n[0],_=n[1],x=n[2];return Math.abs(N-w)<C&&Math.abs(g-_)<C&&Math.abs(M-x)<C?H(r):(l=N-w,f=g-_,p=M-x,d=1/Math.hypot(l,f,p),l*=d,f*=d,p*=d,i=A*p-y*f,s=y*l-m*p,h=m*f-A*l,d=Math.hypot(i,s,h),d?(d=1/d,i*=d,s*=d,h*=d):(i=0,s=0,h=0),a=f*h-p*s,v=p*i-l*h,c=l*s-f*i,d=Math.hypot(a,v,c),d?(d=1/d,a*=d,v*=d,c*=d):(a=0,v=0,c=0),r[0]=i,r[1]=a,r[2]=l,r[3]=0,r[4]=s,r[5]=v,r[6]=f,r[7]=0,r[8]=h,r[9]=c,r[10]=p,r[11]=0,r[12]=-(i*N+s*g+h*M),r[13]=-(a*N+v*g+c*M),r[14]=-(l*N+f*g+p*M),r[15]=1,r)}var lr=L;function J(){var r=new S(3);return S!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function fr(r,e,n){var t=new S(3);return t[0]=r,t[1]=e,t[2]=n,t}function pr(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function dr(r,e,n,t){return r[0]=e,r[1]=n,r[2]=t,r}function yr(r,e){var n=e[0],t=e[1],i=e[2],s=n*n+t*t+i*i;return s>0&&(s=1/Math.sqrt(s)),r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r}function wr(r,e,n){var t=e[0],i=e[1],s=e[2],h=n[0],a=n[1],v=n[2];return r[0]=i*v-s*a,r[1]=s*h-t*v,r[2]=t*a-i*h,r}(function(){var r=J();return function(e,n,t,i,s,h){var a,v;for(n||(n=3),t||(t=0),i?v=Math.min(i*n+t,e.length):v=e.length,a=t;a<v;a+=n)r[0]=e[a],r[1]=e[a+1],r[2]=e[a+2],s(r,r,h),e[a]=r[0],e[a+1]=r[1],e[a+2]=r[2];return e}})();var I=256,B=[],X=256,P;for(;I--;)B[I]=(I+256).toString(16).substring(1);function _r(r){var e=0,n=r||11;if(!P||I+n>X*2)for(P="",I=0;e<X;e++)P+=B[Math.random()*256|0];return P.substring(I,I+++n)}var q={},K=function(){function r(e,n,t,i){this.x=e,this.y=n,this.w=t,this.h=i}return r.prototype.fitsIn=function(e){return e.w>=this.w&&e.h>=this.h},r.prototype.sameSizeAs=function(e){return this.w===e.w&&this.h===e.h},r}();Object.defineProperty(q,"__esModule",{value:!0});q.default=K;var $={},D=q;function Y(r){var e=r.width/2,n=document.createElement("canvas");n.id=r.id||"",n.width=r.width+r.width,n.height=r.height+r.height;var t=n.getContext("2d"),i=t.createPattern(r,"repeat");return t.fillStyle=i,t.translate(e,e),t.fillRect(-e,-e,n.width+e,n.height+e),t.translate(-e,-e),n}function T(r,e,n,t){var i=e?r.rect.w/4:0;return[[r.rect.x+i,r.rect.y+i],[r.rect.x+i+(r.rect.w-i*2),r.rect.y+i],[r.rect.x+i+(r.rect.w-i*2),r.rect.y+i+(r.rect.h-i*2)],[r.rect.x+i,r.rect.y+i+(r.rect.h-i*2)]].map(function(s){return s[0]!==0&&(s[0]=s[0]/n),s[1]!==0&&(s[1]=s[1]/t),s})}function Z(r,e,n,t){var i=e?r.rect.w/4:0,s=new Float32Array(8);return s[0]=(r.rect.x+i)/n,s[1]=(r.rect.y+i)/t,s[2]=(r.rect.x+i+(r.rect.w-i*2))/n,s[3]=(r.rect.y+i)/t,s[4]=(r.rect.x+i+(r.rect.w-i*2))/n,s[5]=(r.rect.y+i+(r.rect.h-i*2))/t,s[6]=(r.rect.x+i)/n,s[7]=(r.rect.y+i+(r.rect.h-i*2))/t,s}var j=function(){function r(e,n,t,i){this.left=this.right=null,this.rect=new D.default(e,n,t,i),this.filled=!1}return r.prototype.pack=function(e){return this.left!==null?this.left.pack(e)||this.right.pack(e):this.filled||!e.fitsIn(this.rect)?null:e.sameSizeAs(this.rect)?(this.filled=!0,this):(this.rect.w-e.w>this.rect.h-e.h?(this.left=new r(this.rect.x,this.rect.y,e.w,this.rect.h),this.right=new r(this.rect.x+e.w,this.rect.y,this.rect.w-e.w,this.rect.h)):(this.left=new r(this.rect.x,this.rect.y,this.rect.w,e.h),this.right=new r(this.rect.x,this.rect.y+e.h,this.rect.w,this.rect.h-e.h)),this.left.pack(e))},r}();$.AtlasNode=j;var Q=function(){function r(e,n){n===void 0&&(n={}),this.tilepad=n.tilepad||!1,this.canvas=e,this.context=e.getContext("2d"),this._rootNode=new j(0,0,this.canvas.width,this.canvas.height),this._terminalNodes={},this.invalidateUvIndices()}return r.prototype.pack=function(e,n){return this._checkId(e),this._pack(e,this.tilepad?Y(n):n)},r.prototype.expand=function(e,n){return this._checkId(e),this.invalidateUvIndices(),this._expand(e,this.tilepad?Y(n):n)},r.prototype.index=function(){var e=this;return Object.keys(this._terminalNodes).map(function(n){return e._terminalNodes[n].rect})},r.prototype.uv=function(){return this._uvs?this._uvs:(this._uvs=this.buildUvIndex(),this._uvs)},r.prototype.uv2=function(){return this._uvs2?this._uvs2:(this._uvs2=this.buildUvIndex2(),this._uvs2)},r.prototype.invalidateUvIndices=function(){this._uvs=null,this._uvs2=null},r.prototype._checkId=function(e){if(this._terminalNodes[e])throw new Error("Duplicated texture id "+e)},r.prototype._pack=function(e,n){var t=new D.default(0,0,n.width,n.height),i=this._rootNode.pack(t);return i?(this._ontoCanvas(e,n,i.rect),this._terminalNodes[e]=i,this._uvs&&(this._uvs[e]=T(i,this.tilepad,this.canvas.width,this.canvas.height)),this._uvs2&&(this._uvs2[e]=Z(i,this.tilepad,this.canvas.width,this.canvas.height)),i):null},r.prototype._expand=function(e,n){var t=new D.default(0,0,n.width,n.height),i=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),s;this._rootNode.rect.w<this._rootNode.rect.h?(this.canvas.width=this._rootNode.rect.w+t.w,s=new j(this._rootNode.rect.w,0,t.w,this._rootNode.rect.h)):(this.canvas.height=this._rootNode.rect.h+t.h,s=new j(0,this._rootNode.rect.h,this._rootNode.rect.w,t.h)),this.context.putImageData(i,0,0);var h=this._rootNode;return this._rootNode=new j(0,0,this.canvas.width,this.canvas.height),this._rootNode.left=h,this._rootNode.right=s,this._pack(e,n)?this:this._expand(e,n)},r.prototype.buildUvIndex=function(){var e=this,n={};return Object.keys(this._terminalNodes).map(function(t){var i=e._terminalNodes[t];n[t]=T(i,e.tilepad,e.canvas.width,e.canvas.height)}),n},r.prototype.buildUvIndex2=function(){var e=this,n={};return Object.keys(this._terminalNodes).map(function(t){var i=e._terminalNodes[t];n[t]=Z(i,e.tilepad,e.canvas.width,e.canvas.height)}),n},r.prototype._ontoCanvas=function(e,n,t){this.context.clearRect(t.x,t.y,t.w,t.h),this.context.drawImage(n,t.x,t.y,t.w,t.h)},r}();Object.defineProperty($,"__esModule",{value:!0});$.default=Q;var W=$,xr=W.default;export{xr as A,wr as a,o as b,J as c,u as d,pr as e,fr as f,H as g,ir as h,er as i,sr as j,hr as k,cr as l,lr as m,yr as n,vr as o,ar as p,tr as q,nr as r,dr as s,rr as t,_r as u};
